import{bK as U,bL as I,v as E,o as R,X as p,_ as m,U as Z,a0 as C,O as t,ao as n,am as d}from"./index-BhYpgZC5.js";import{b as x}from"./route-block-B_A1xBdJ.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const P=""+new URL("095-U6-DrwndUNv.jpg",import.meta.url).href,k=""+new URL("406-U5-D31oWwXm.jpg",import.meta.url).href,O=""+new URL("409-FW-BWsWpGGh.jpg",import.meta.url).href,Y=""+new URL("EAL-3068-D2e_lDcp.jpg",import.meta.url).href,G=""+new URL("FAB-512-DTxE6gtJ.jpg",import.meta.url).href,J=""+new URL("KKB-2295-BXBzZuZQ.jpg",import.meta.url).href,N={login(l){return U.busapi.post("https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",l,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},getCurrentBus(l,u,c){return U.busapiAuth.get(`v2/Bus/RealTimeNearStop/City/${l}/${u}`,{params:{$top:c,$format:"JSON"}})},getNextStations(l,u,c,A){return U.busapiAuth.get(`v2/Bus/DisplayStopOfRoute/City/${l}/${u}`,{params:{$filter:`RouteID eq '${c}' and Direction eq '${A}'`,$format:"JSON"}})}},j={class:"bus-list"},X=["src"],q={class:"bus-info"},z={style:{color:"red"}},Q={style:{color:"green"}},V={style:{border:"1px solid red",width:"60%",padding:"10px","border-radius":"8px"}},M={key:0},H={key:1},ee={style:{"font-size":"1.5rem",color:"black"}},te={style:{"font-size":"1.5rem",color:"blue"}},oe={style:{"font-size":"1.3rem",color:"black"}},T={__name:"businfo",setup(l){const u=I(),c="a772288411-11a1cca4-06fb-4671",A="6350766b-a502-42c4-9d2b-2d6d26a66ea6",B=E([{title:"三重客運DAEWOO BS120CN(成運五期低地板)",busbodyshop:"成運",vehiclelength:"12,050mm",buswheelbase:"6,100mm",Transmissionsystem:"ALLISON T375R自排(前6後1)",Licenserange:"137-U5~176-U5(2013年生產)、395-U5~429-U5.433-U5~449-U5.488-U5~502-U5.525-U5~539-U5.630-U5~648-U5.661-U5~679-U5(2014年生產)、928-U3~937-U3.169-U7~192-U7.FAB-186~FAB-193.FAB-197~FAB-200.FAB-202~FAB-206.FAB-209.FAB-211~FAB-213.FAB-252~FAB-263.FAB-266.FAB-268.FAB-270.FAB-272~FAB-275(2015年生產)",busroute:{routeName:"822",license:"406-U5",city:"NewTaipei"},description:"方便長者和輪椅族群上下車的低地板設計。",image:k,stopName:"",nextStations:[],currentLocation:{latitude:null,longitude:null}},{title:"三重客運RAC RAC-700-ELCB-2802(大型電動車⚡️)",busbodyshop:"華德動能科技",vehiclelength:"11,980mm",buswheelbase:"5,800mm",Transmissionsystem:"Eaton六速自手排",Licenserange:"EAL-3050~EAL-3071(2023年生產)",busroute:{routeName:"637",license:"EAL-3068",city:"NewTaipei"},description:"零碳排環保公車，推動綠色交通。",image:Y,stopName:"",nextStations:["",""],currentLocation:{latitude:null,longitude:null}},{title:"指南客運KINGLONG KL6112U1(短軸版，五期引擎)",busbodyshop:"金龍汽車製造",vehiclelength:"11,200mm",buswheelbase:"5,300mm",Transmissionsystem:"綦江QJ1205手排(前5後1)、Voith DIWA854.5自排(前4後1)",Licenserange:"027-FY~049-FY、240-FY~241-FY、266-FY~278-FY、571-FZ~581-FZ、742-FW~750-FW(2012年生產)、737-FZ~763-FZ、988-FZ~999-FZ、FAA-097~FAA-099、FAA-116~FAA-117、401-FY~411-FY、816-FX~820-FX(2013年生產)、110-U3~129-U3、133-U3~137-U3、365-U3~388-U3、489-U3、568-U3~571-U3、940-U5~971-U5(2014年生產)、037-U6~039-U6、050-U6~056-U6、093-U6~100-U6、301-U6~303-U6、062-U7~065-U7、070-U7~071-U7(2015年生產)、KKB-0170~KKB-0171(2021年生產)",busroute:{routeName:"801",license:"095-U6",city:"NewTaipei"},description:"方便長者和輪椅族群上下車的低地板設計。",image:P,stopName:"",nextStations:[],currentLocation:{latitude:null,longitude:null}},{title:"指南客運KINGLONG KL6112U1(短軸版，四期引擎)",busbodyshop:"金龍汽車製造",vehiclelength:"11,200mm",buswheelbase:"5,300mm",Transmissionsystem:"綦江QJ1205手排(前5後1)",Licenserange:"405-FW~420-FW、479-FW~500-FW、045-FZ~052-FZ(2012年生產)",busroute:{routeName:"801",license:"409-FW",city:"NewTaipei"},description:"方便長者和輪椅族群上下車的低地板設計。",image:O,stopName:"",nextStations:[],currentLocation:{latitude:null,longitude:null}},{title:"大有巴士YUTONG ZK6128HG",busbodyshop:"台灣宇通實業",vehiclelength:"11,990mm",buswheelbase:"5,875mm",Transmissionsystem:"ZF EcoLife 6AP1200B自排(前6後1)",Licenserange:"FAB-387~FAB-389、FAB-391~FAB-395、FAB-397~FAB-399、FAB-500~FAB-510、FAB-512~FAB-513、FAB-516、FAB-767~FAB-769、FAB-771~FAB-775、FAB-976~FAB-979、KKA-1029~KKA-1036(2016年生產)",busroute:{routeName:"257",license:"FAB-512",city:"Taipei"},description:"方便長者和輪椅族群上下車的低地板設計。",image:G,stopName:"",nextStations:["",""],currentLocation:{latitude:null,longitude:null}},{title:"大有巴士JIAMA JC290E6-5850(總盈)",busbodyshop:"總盈",vehiclelength:"12,030mm",buswheelbase:"5,850mm",Transmissionsystem:"ZF EcoLife2 6AP1220B自排(前6後1)",Licenserange:"KKB-2290~KKB-2297(2024年生產)",busroute:{routeName:"257",license:"KKB-2295",city:"Taipei"},description:"方便長者和輪椅族群上下車的低地板設計。",image:J,stopName:"",nextStations:[],currentLocation:{latitude:null,longitude:null}}]),v=async()=>{try{const s=new URLSearchParams;s.append("grant_type","client_credentials"),s.append("client_id",c),s.append("client_secret",A);const{data:e}=await N.login(s);u.login(e)}catch(s){console.error("bus登入失敗",s)}},K=async(s,e)=>{var o,a,y;try{console.log("=============",s,e);const h=await N.getCurrentBus(s,e,30)||[];console.log("搜尋路線:",e);for(const r of B.value)try{if(r.busroute.routeName===e){console.log("處理車牌:",r.busroute.license);const i=h.data.find(D=>D.PlateNumb===r.busroute.license);console.log("matchedBus",i);const L=i&&((o=i.StopName)==null?void 0:o.Zh_tw)||"",g=i&&i.StopSequence||"";console.log(`目前所在站點: ${L}(${g})`);const f=i&&i.RouteID||"",S=i&&i.Direction||0;console.log("routeID",f),console.log("direction",S);const F=await N.getNextStations(s,e,f,S)||[],b=F.data[0].Stops[Number.parseInt(g)-1]||{},w=F.data[0].Stops[Number.parseInt(g)]||{},_=F.data[0].Stops[Number.parseInt(g)+1]||{};console.log("res2",F),console.log("目前站站點 - 經度:",b.StopPosition.PositionLat||"無資料"),console.log("目前站站點 - 緯度:",b.StopPosition.PositionLon||"無資料"),console.log("下 1 站站點:",w),console.log("下 2 站站點:",_),r.stopName=L,r.nextStations=[((a=w.StopName)==null?void 0:a.Zh_tw)||"無資料",((y=_.StopName)==null?void 0:y.Zh_tw)||"無資料"],r.currentLocation={latitude:b.StopPosition.PositionLat||"無資料",longitude:b.StopPosition.PositionLon||"無資料"},console.log("[寫入 bus 資料]",r.stopName),console.log("[寫入 bus 資料]",r.nextStations),console.log("[寫入 bus 位置]",r.currentLocation)}}catch(i){console.error("處理車輛資料錯誤",i)}}catch(h){console.error("取得公車動態失敗",h)}};R(async()=>{await v();const s=[...new Set(B.value.map(e=>`${e.busroute.city}-${e.busroute.routeName}`))];for(const e of s){const[o,a]=e.split("-");await K(o,a)}});const $=s=>{const e=s.nextStations;return!Array.isArray(e)||e.length===0||!e[0]?"下一站：無資料":e.length===1||!e[1]?`下一站：${e[0]}`:e[1]?`下兩站：${e[0]} 和 ${e[1]}`:`下一站：${e[0]}`};return(s,e)=>(m(),p("div",j,[(m(!0),p(Z,null,C(B.value,(o,a)=>(m(),p("div",{key:a,class:"bus-card"},[t("img",{alt:"公車圖片",class:"bus-image",src:o.image},null,8,X),t("div",q,[t("h3",null,n(o.title),1),t("h4",null,"車體廠："+n(o.busbodyshop),1),t("h4",null,"車長："+n(o.vehiclelength),1),t("h4",null,"軸距："+n(o.buswheelbase),1),t("h4",null,"變速系統："+n(o.Transmissionsystem),1),t("p",null,"領牌範圍："+n(o.Licenserange),1),t("b",null,[e[0]||(e[0]=d(" 圖片資訊是",-1)),t("span",z,n(o.busroute.routeName),1),t("span",Q,"的"+n(o.busroute.license),1)]),t("h5",null,n(o.description),1),e[7]||(e[7]=t("br",null,null,-1)),t("div",V,[e[6]||(e[6]=t("h2",{style:{"text-decoration":"underline"}},"即時公車動態",-1)),o.stopName?(m(),p("div",H,[t("p",null,[e[2]||(e[2]=d("目前站: ",-1)),t("span",ee,n(o.stopName||"無資料"),1)]),t("p",null,[t("span",te,n($(o)),1)]),t("p",null,[t("span",oe,[e[3]||(e[3]=d(" 公車目前站點位置: ",-1)),e[4]||(e[4]=t("br",null,null,-1)),d(" 經度 "+n(o.currentLocation.longitude??"無")+" ",1),e[5]||(e[5]=t("br",null,null,-1)),d(" 緯度 "+n(o.currentLocation.latitude??"無"),1)])])])):(m(),p("div",M,e[1]||(e[1]=[t("p",{style:{"font-size":"1.5rem",color:"red"}},"尚未發車...",-1)])))])])]))),128))]))}};typeof x=="function"&&x(T);const re=W(T,[["__scopeId","data-v-3ad09f50"]]);export{re as default};
